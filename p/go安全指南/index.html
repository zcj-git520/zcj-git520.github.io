<!DOCTYPE html>
<html lang="zh-cn">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='文章来源 鹅厂(腾讯)代码安全指南
通用 内存管理 【必须】切片长度校验  在对slice进行操作时，必须判断长度是否合法，防止程序panic  // bad: 未判断data的长度，可导致 index out of range func decode(data []byte) bool { if data[0] == &#39;F&#39; &amp;amp;&amp;amp; data[1] == &#39;U&#39; &amp;amp;&amp;amp; data[2] == &#39;Z&#39; &amp;amp;&amp;amp; data[3] == &#39;Z&#39; &amp;amp;&amp;amp; data[4] == &#39;E&#39; &amp;amp;&amp;amp; data[5] == &#39;R&#39; { fmt.Println(&amp;quot;Bad&amp;quot;) return true } return false } // bad: slice bounds out of range func foo() { var slice = []int{0, 1, 2, 3, 4, 5, 6} fmt.'><title>Go安全指南</title>

<link rel='canonical' href='https://zcj-git520.github.io/p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Go安全指南'>
<meta property='og:description' content='文章来源 鹅厂(腾讯)代码安全指南
通用 内存管理 【必须】切片长度校验  在对slice进行操作时，必须判断长度是否合法，防止程序panic  // bad: 未判断data的长度，可导致 index out of range func decode(data []byte) bool { if data[0] == &#39;F&#39; &amp;amp;&amp;amp; data[1] == &#39;U&#39; &amp;amp;&amp;amp; data[2] == &#39;Z&#39; &amp;amp;&amp;amp; data[3] == &#39;Z&#39; &amp;amp;&amp;amp; data[4] == &#39;E&#39; &amp;amp;&amp;amp; data[5] == &#39;R&#39; { fmt.Println(&amp;quot;Bad&amp;quot;) return true } return false } // bad: slice bounds out of range func foo() { var slice = []int{0, 1, 2, 3, 4, 5, 6} fmt.'>
<meta property='og:url' content='https://zcj-git520.github.io/p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/'>
<meta property='og:site_name' content='Chengji Zhao&#39;s blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2021-10-24T22:00:08&#43;08:00'/><meta property='article:modified_time' content='2021-10-24T22:00:08&#43;08:00'/><meta property='og:image' content='https://zcj-git520.github.io/p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/1.jpg' />
<meta name="twitter:title" content="Go安全指南">
<meta name="twitter:description" content="文章来源 鹅厂(腾讯)代码安全指南
通用 内存管理 【必须】切片长度校验  在对slice进行操作时，必须判断长度是否合法，防止程序panic  // bad: 未判断data的长度，可导致 index out of range func decode(data []byte) bool { if data[0] == &#39;F&#39; &amp;amp;&amp;amp; data[1] == &#39;U&#39; &amp;amp;&amp;amp; data[2] == &#39;Z&#39; &amp;amp;&amp;amp; data[3] == &#39;Z&#39; &amp;amp;&amp;amp; data[4] == &#39;E&#39; &amp;amp;&amp;amp; data[5] == &#39;R&#39; { fmt.Println(&amp;quot;Bad&amp;quot;) return true } return false } // bad: slice bounds out of range func foo() { var slice = []int{0, 1, 2, 3, 4, 5, 6} fmt."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://zcj-git520.github.io/p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/1.jpg' />
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>返回</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/">
                <img src="/p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/1_hu7c5d570e6f1bb8cc35e9c2f13acb3eec_11753_800x0_resize_q75_box.jpg"
                        srcset="/p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/1_hu7c5d570e6f1bb8cc35e9c2f13acb3eec_11753_800x0_resize_q75_box.jpg 800w, /p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/1_hu7c5d570e6f1bb8cc35e9c2f13acb3eec_11753_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="579" 
                        loading="lazy"
                        alt="Featured image of post Go安全指南" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/language/" style="background-color: #2a9d8f; color: #fff;">
                语言学习
            </a>
        
            <a href="/categories/golang/" style="background-color: #2a9d8f; color: #fff;">
                Golang
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97/">Go安全指南</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Oct 24, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 10 分钟
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h2 id="文章来源">文章来源</h2>
<p><a class="link" href="https://github.com/Tencent/secguide"  target="_blank" rel="noopener"
    >鹅厂(腾讯)代码安全指南</a></p>
<h2 id="通用">通用</h2>
<h3 id="内存管理">内存管理</h3>
<h4 id="必须切片长度校验">【必须】切片长度校验</h4>
<ul>
<li>在对slice进行操作时，必须判断长度是否合法，防止程序panic</li>
</ul>
<pre tabindex="0"><code>// bad: 未判断data的长度，可导致 index out of range
func decode(data []byte) bool {
	if data[0] == 'F' &amp;&amp; data[1] == 'U' &amp;&amp; data[2] == 'Z' &amp;&amp; data[3] == 'Z' &amp;&amp; data[4] == 'E' &amp;&amp; data[5] == 'R' {
		fmt.Println(&quot;Bad&quot;)
		return true
	}
	return false
}

// bad: slice bounds out of range
func foo() {
	var slice = []int{0, 1, 2, 3, 4, 5, 6}
	fmt.Println(slice[:10])
}

// good: 使用data前应判断长度是否合法
func decode(data []byte) bool {
	if len(data) == 6 {
		if data[0] == 'F' &amp;&amp; data[1] == 'U' &amp;&amp; data[2] == 'Z' &amp;&amp; data[3] == 'Z' &amp;&amp; data[4] == 'E' &amp;&amp; data[5] == 'R' {
			fmt.Println(&quot;Good&quot;)
			return true
		}
	}
	return false
}
</code></pre><h4 id="必须nil指针判断">【必须】nil指针判断</h4>
<ul>
<li>进行指针操作时，必须判断该指针是否为nil，防止程序panic，尤其在进行结构体Unmarshal时</li>
</ul>
<pre tabindex="0"><code>type Packet struct {
	PackeyType    uint8
	PackeyVersion uint8
	Data          *Data
}

type Data struct {
	Stat uint8
	Len  uint8
	Buf  [8]byte
}

func (p *Packet) UnmarshalBinary(b []byte) error {
	if len(b) &lt; 2 {
		return io.EOF
	}

	p.PackeyType = b[0]
	p.PackeyVersion = b[1]

	// 若长度等于2，那么不会new Data
	if len(b) &gt; 2 {
		p.Data = new(Data)
	}
	return nil
}

// bad: 未判断指针是否为nil
func main() {
	packet := new(Packet)
	data := make([]byte, 2)
	if err := packet.UnmarshalBinary(data); err != nil {
		fmt.Println(&quot;Failed to unmarshal packet&quot;)
		return
	}

	fmt.Printf(&quot;Stat: %v\n&quot;, packet.Data.Stat)
}

// good: 判断Data指针是否为nil
func main() {
	packet := new(Packet)
	data := make([]byte, 2)

	if err := packet.UnmarshalBinary(data); err != nil {
		fmt.Println(&quot;Failed to unmarshal packet&quot;)
		return
	}

	if packet.Data == nil {
		return
	}

	fmt.Printf(&quot;Stat: %v\n&quot;, packet.Data.Stat)
}
</code></pre><h4 id="必须整数安全">【必须】整数安全</h4>
<ul>
<li>
<p>在进行数字运算操作时，需要做好长度限制，防止外部输入运算导致异常：</p>
<ul>
<li>确保无符号整数运算时不会反转</li>
<li>确保有符号整数运算时不会出现溢出</li>
<li>确保整型转换时不会出现截断错误</li>
<li>确保整型转换时不会出现符号错误</li>
</ul>
</li>
<li>
<p>以下场景必须严格进行长度限制：</p>
<ul>
<li>作为数组索引</li>
<li>作为对象的长度或者大小</li>
<li>作为数组的边界（如作为循环计数器）</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>// bad: 未限制长度，导致整数溢出
func overflow(numControlByUser int32) {
	var numInt int32 = 0
	numInt = numControlByUser + 1
	// 对长度限制不当，导致整数溢出
	fmt.Printf(&quot;%d\n&quot;, numInt)
	// 使用numInt，可能导致其他错误
}

func main() {
	overflow(2147483647)
}

// good
func overflow(numControlByUser int32) {
	var numInt int32 = 0
	numInt = numControlByUser + 1
	if numInt &lt; 0 {
		fmt.Println(&quot;integer overflow&quot;)
		return
	}
	fmt.Println(&quot;integer ok&quot;)
}

func main() {
	overflow(2147483647)
}
</code></pre><h4 id="必须make分配长度验证">【必须】make分配长度验证</h4>
<ul>
<li>在进行make分配内存时，需要对外部可控的长度进行校验，防止程序panic。</li>
</ul>
<pre tabindex="0"><code>// bad
func parse(lenControlByUser int, data []byte) {
	size := lenControlByUser
	// 对外部传入的size，进行长度判断以免导致panic
	buffer := make([]byte, size)
	copy(buffer, data)
}

// good
func parse(lenControlByUser int, data []byte) ([]byte, error) {
	size := lenControlByUser
	// 限制外部可控的长度大小范围
	if size &gt; 64*1024*1024 {
		return nil, errors.New(&quot;value too large&quot;)
	}
	buffer := make([]byte, size)
	copy(buffer, data)
	return buffer, nil
}
</code></pre><h4 id="必须禁止setfinalizer和指针循环引用同时使用">【必须】禁止SetFinalizer和指针循环引用同时使用</h4>
<ul>
<li>当一个对象从被GC选中到移除内存之前，runtime.SetFinalizer()都不会执行，即使程序正常结束或者发生错误。由指针构成的“循环引用”虽然能被GC正确处理，但由于无法确定Finalizer依赖顺序，从而无法调用runtime.SetFinalizer()，导致目标对象无法变成可达状态，从而造成内存无法被回收。</li>
</ul>
<pre tabindex="0"><code>// bad
func foo() {
	var a, b Data
	a.o = &amp;b
	b.o = &amp;a

	// 指针循环引用，SetFinalizer()无法正常调用
	runtime.SetFinalizer(&amp;a, func(d *Data) {
		fmt.Printf(&quot;a %p final.\n&quot;, d)
	})
	runtime.SetFinalizer(&amp;b, func(d *Data) {
		fmt.Printf(&quot;b %p final.\n&quot;, d)
	})
}

func main() {
	for {
		foo()
		time.Sleep(time.Millisecond)
	}
}

</code></pre><h4 id="必须禁止重复释放channel">【必须】禁止重复释放channel</h4>
<ul>
<li>重复释放一般存在于异常流程判断中，如果恶意攻击者构造出异常条件使程序重复释放channel，则会触发运行时panic，从而造成DoS攻击。</li>
</ul>
<pre tabindex="0"><code>// bad
func foo(c chan int) {
	defer close(c)
	err := processBusiness()
	if err != nil {
		c &lt;- 0
		close(c) // 重复释放channel
		return
	}
	c &lt;- 1
}

// good
func foo(c chan int) {
	defer close(c) // 使用defer延迟关闭channel
	err := processBusiness()
	if err != nil {
		c &lt;- 0
		return
	}
	c &lt;- 1
}
</code></pre><h4 id="必须确保每个协程都能退出">【必须】确保每个协程都能退出</h4>
<ul>
<li>启动一个协程就会做一个入栈操作，在系统不退出的情况下，协程也没有设置退出条件，则相当于协程失去了控制，它占用的资源无法回收，可能会导致内存泄露。</li>
</ul>
<pre tabindex="0"><code>// bad: 协程没有设置退出条件
func doWaiter(name string, second int) {
	for {
		time.Sleep(time.Duration(second) * time.Second)
		fmt.Println(name, &quot; is ready!&quot;)
	}
}
</code></pre><h4 id="推荐不使用unsafe包">【推荐】不使用unsafe包</h4>
<ul>
<li>由于unsafe包绕过了 Golang 的内存安全原则，一般来说使用该库是不安全的，可导致内存破坏，尽量避免使用该包。若必须要使用unsafe操作指针，必须做好安全校验。</li>
</ul>
<pre tabindex="0"><code>// bad: 通过unsafe操作原始指针
func unsafePointer() {
	b := make([]byte, 1)
	foo := (*int)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;b[0])) + uintptr(0xfffffffe)))
	fmt.Print(*foo + 1)
}

// [signal SIGSEGV: segmentation violation code=0x1 addr=0xc100068f55 pc=0x49142b]

</code></pre><h4 id="推荐不使用slice作为函数入参">【推荐】不使用slice作为函数入参</h4>
<ul>
<li>slice是引用类型，在作为函数入参时采用的是地址传递，对slice的修改也会影响原始数据</li>
</ul>
<pre tabindex="0"><code>// bad: slice作为函数入参时是地址传递
func modify(array []int) {
	array[0] = 10 // 对入参slice的元素修改会影响原始数据
}

func main() {
	array := []int{1, 2, 3, 4, 5}

	modify(array)
	fmt.Println(array) // output：[10 2 3 4 5]
}

// good: 函数使用数组作为入参，而不是slice
func modify(array [5]int) {
	array[0] = 10
}

func main() {
	// 传入数组，注意数组与slice的区别
	array := [5]int{1, 2, 3, 4, 5}

	modify(array)
	fmt.Println(array)
}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="文件操作">文件操作</h3>
<h4 id="必须-路径穿越检查">【必须】 路径穿越检查</h4>
<ul>
<li>在进行文件操作时，如果对外部传入的文件名未做限制，可能导致任意文件读取或者任意文件写入，严重可能导致代码执行。</li>
</ul>
<pre tabindex="0"><code>// bad: 任意文件读取
func handler(w http.ResponseWriter, r *http.Request) {
	path := r.URL.Query()[&quot;path&quot;][0]

	// 未过滤文件路径，可能导致任意文件读取
	data, _ := ioutil.ReadFile(path)
	w.Write(data)

	// 对外部传入的文件名变量，还需要验证是否存在../等路径穿越的文件名
	data, _ = ioutil.ReadFile(filepath.Join(&quot;/home/user/&quot;, path))
	w.Write(data)
}

// bad: 任意文件写入
func unzip(f string) {
	r, _ := zip.OpenReader(f)
	for _, f := range r.File {
		p, _ := filepath.Abs(f.Name)
		// 未验证压缩文件名，可能导致../等路径穿越，任意文件路径写入
		ioutil.WriteFile(p, []byte(&quot;present&quot;), 0640)
	}
}

// good: 检查压缩的文件名是否包含..路径穿越特征字符，防止任意写入
func unzipGood(f string) bool {
	r, err := zip.OpenReader(f)
	if err != nil {
		fmt.Println(&quot;read zip file fail&quot;)
		return false
	}
	for _, f := range r.File {
		if !strings.Contains(f.Name, &quot;..&quot;) {
			p, _ := filepath.Abs(f.Name)
			ioutil.WriteFile(p, []byte(&quot;present&quot;), 0640)
		} else {
			return false
		}
	}
	return true
}
</code></pre><h4 id="必须-文件访问权限">【必须】 文件访问权限</h4>
<ul>
<li>根据创建文件的敏感性设置不同级别的访问权限，以防止敏感数据被任意权限用户读取。例如，设置文件权限为：<code>-rw-r-----</code></li>
</ul>
<pre tabindex="0"><code>ioutil.WriteFile(p, []byte(&quot;present&quot;), 0640)
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="系统接口">系统接口</h3>
<p><strong>1.3.1【必须】命令执行检查</strong></p>
<ul>
<li>使用<code>exec.Command</code>、<code>exec.CommandContext</code>、<code>syscall.StartProcess</code>、<code>os.StartProcess</code>等函数时，第一个参数（path）直接取外部输入值时，应使用白名单限定可执行的命令范围，不允许传入<code>bash</code>、<code>cmd</code>、<code>sh</code>等命令；</li>
<li>使用<code>exec.Command</code>、<code>exec.CommandContext</code>等函数时，通过<code>bash</code>、<code>cmd</code>、<code>sh</code>等创建shell，-c后的参数（arg）拼接外部输入，应过滤\n  $  &amp;  ;  |  '  &quot;  ( )  `等潜在恶意字符；</li>
</ul>
<pre tabindex="0"><code>// bad
func foo() {
	userInputedVal := &quot;&amp;&amp; echo 'hello'&quot; // 假设外部传入该变量值
	cmdName := &quot;ping &quot; + userInputedVal

	// 未判断外部输入是否存在命令注入字符，结合sh可造成命令注入
	cmd := exec.Command(&quot;sh&quot;, &quot;-c&quot;, cmdName)
	output, _ := cmd.CombinedOutput()
	fmt.Println(string(output))

	cmdName := &quot;ls&quot;
	// 未判断外部输入是否是预期命令
	cmd := exec.Command(cmdName)
	output, _ := cmd.CombinedOutput()
	fmt.Println(string(output))
}

// good
func checkIllegal(cmdName string) bool {
	if strings.Contains(cmdName, &quot;&amp;&quot;) || strings.Contains(cmdName, &quot;|&quot;) || strings.Contains(cmdName, &quot;;&quot;) ||
		strings.Contains(cmdName, &quot;$&quot;) || strings.Contains(cmdName, &quot;'&quot;) || strings.Contains(cmdName, &quot;`&quot;) ||
		strings.Contains(cmdName, &quot;(&quot;) || strings.Contains(cmdName, &quot;)&quot;) || strings.Contains(cmdName, &quot;\&quot;&quot;) {
		return true
	}
	return false
}

func main() {
	userInputedVal := &quot;&amp;&amp; echo 'hello'&quot;
	cmdName := &quot;ping &quot; + userInputedVal

	if checkIllegal(cmdName) { // 检查传给sh的命令是否有特殊字符
		return // 存在特殊字符直接return
	}

	cmd := exec.Command(&quot;sh&quot;, &quot;-c&quot;, cmdName)
	output, _ := cmd.CombinedOutput()
	fmt.Println(string(output))
}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="通信安全">通信安全</h3>
<h4 id="必须网络通信采用tls方式">【必须】网络通信采用TLS方式</h4>
<ul>
<li>明文传输的通信协议目前已被验证存在较大安全风险，被中间人劫持后可能导致许多安全风险，因此必须采用至少TLS的安全通信方式保证通信安全，例如gRPC/Websocket都使用TLS1.3。</li>
</ul>
<pre tabindex="0"><code>// good
func main() {
	http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, req *http.Request) {
		w.Header().Add(&quot;Strict-Transport-Security&quot;, &quot;max-age=63072000; includeSubDomains&quot;)
		w.Write([]byte(&quot;This is an example server.\n&quot;))
	})

	// 服务器配置证书与私钥
	log.Fatal(http.ListenAndServeTLS(&quot;:443&quot;, &quot;yourCert.pem&quot;, &quot;yourKey.pem&quot;, nil))
}
</code></pre><h4 id="推荐tls启用证书验证">【推荐】TLS启用证书验证</h4>
<ul>
<li>TLS证书应当是有效的、未过期的，且配置正确的域名，生产环境的服务端应启用证书验证。</li>
</ul>
<pre tabindex="0"><code>// bad
import (
	&quot;crypto/tls&quot;
	&quot;net/http&quot;
)

func doAuthReq(authReq *http.Request) *http.Response {
	tr := &amp;http.Transport{
		TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},
	}
	client := &amp;http.Client{Transport: tr}
	res, _ := client.Do(authReq)
	return res
}

// good
import (
	&quot;crypto/tls&quot;
	&quot;net/http&quot;
)

func doAuthReq(authReq *http.Request) *http.Response {
	tr := &amp;http.Transport{
		TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: false},
	}
	client := &amp;http.Client{Transport: tr}
	res, _ := client.Do(authReq)
	return res
}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="敏感数据保护">敏感数据保护</h3>
<h4 id="必须敏感信息访问">【必须】敏感信息访问</h4>
<ul>
<li>禁止将敏感信息硬编码在程序中，既可能会将敏感信息暴露给攻击者，也会增加代码管理和维护的难度</li>
<li>使用配置中心系统统一托管密钥等敏感信息</li>
</ul>
<h4 id="必须敏感数据输出">【必须】敏感数据输出</h4>
<ul>
<li>只输出必要的最小数据集，避免多余字段暴露引起敏感信息泄露</li>
<li>不能在日志保存密码（包括明文密码和密文密码）、密钥和其它敏感信息</li>
<li>对于必须输出的敏感信息，必须进行合理脱敏展示</li>
</ul>
<pre tabindex="0"><code>// bad
func serve() {
	http.HandleFunc(&quot;/register&quot;, func(w http.ResponseWriter, r *http.Request) {
		r.ParseForm()
		user := r.Form.Get(&quot;user&quot;)
		pw := r.Form.Get(&quot;password&quot;)

		log.Printf(&quot;Registering new user %s with password %s.\n&quot;, user, pw)
	})
	http.ListenAndServe(&quot;:80&quot;, nil)
}

// good
func serve1() {
	http.HandleFunc(&quot;/register&quot;, func(w http.ResponseWriter, r *http.Request) {
		r.ParseForm()
		user := r.Form.Get(&quot;user&quot;)
		pw := r.Form.Get(&quot;password&quot;)

		log.Printf(&quot;Registering new user %s.\n&quot;, user)

		// ...
		use(pw)
	})
	http.ListenAndServe(&quot;:80&quot;, nil)
}
</code></pre><ul>
<li>避免通过GET方法、代码注释、自动填充、缓存等方式泄露敏感信息</li>
</ul>
<h4 id="必须敏感数据存储">【必须】敏感数据存储</h4>
<ul>
<li>敏感数据应使用SHA2、RSA等算法进行加密存储</li>
<li>敏感数据应使用独立的存储层，并在访问层开启访问控制</li>
<li>包含敏感信息的临时文件或缓存一旦不再需要应立刻删除</li>
</ul>
<h4 id="必须异常处理和日志记录">【必须】异常处理和日志记录</h4>
<ul>
<li>应合理使用panic、recover、defer处理系统异常，避免出错信息输出到前端</li>
</ul>
<pre tabindex="0"><code>defer func () {
	if r := recover(); r != nil {
		fmt.Println(&quot;Recovered in start()&quot;)
	}
}()
</code></pre><ul>
<li>对外环境禁止开启debug模式，或将程序运行日志输出到前端</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">// bad
dlv --listen<span class="o">=</span>:2345 --headless<span class="o">=</span><span class="nb">true</span> --api-version<span class="o">=</span><span class="m">2</span> debug test.go
// good
dlv debug test.go
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="加密解密">加密解密</h3>
<h4 id="必须不得硬编码密码密钥">【必须】不得硬编码密码/密钥</h4>
<ul>
<li>在进行用户登陆，加解密算法等操作时，不得在代码里硬编码密钥或密码，可通过变换算法或者配置等方式设置密码或者密钥。</li>
</ul>
<pre tabindex="0"><code>// bad
const (
	user     = &quot;dbuser&quot;
	password = &quot;s3cretp4ssword&quot;
)

func connect() *sql.DB {
	connStr := fmt.Sprintf(&quot;postgres://%s:%s@localhost/pqgotest&quot;, user, password)
	db, err := sql.Open(&quot;postgres&quot;, connStr)
	if err != nil {
		return nil
	}
	return db
}

// bad
var (
	commonkey = []byte(&quot;0123456789abcdef&quot;)
)

func AesEncrypt(plaintext string) (string, error) {
	block, err := aes.NewCipher(commonkey)
	if err != nil {
		return &quot;&quot;, err
	}
}
</code></pre><h4 id="162必须密钥存储安全">1.6.2【必须】密钥存储安全</h4>
<ul>
<li>在使用对称密码算法时，需要保护好加密密钥。当算法涉及敏感、业务数据时，可通过非对称算法协商加密密钥。其他较为不敏感的数据加密，可以通过变换算法等方式保护密钥。</li>
</ul>
<h4 id="163推荐不使用弱密码算法">1.6.3【推荐】不使用弱密码算法</h4>
<ul>
<li>在使用加密算法时，不建议使用加密强度较弱的算法。</li>
</ul>
<pre tabindex="0"><code>// bad
crypto/des，crypto/md5，crypto/sha1，crypto/rc4等。

// good
crypto/rsa，crypto/aes等。
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="正则表达式">正则表达式</h3>
<h4 id="推荐使用regexp进行正则表达式匹配">【推荐】使用regexp进行正则表达式匹配</h4>
<ul>
<li>正则表达式编写不恰当可被用于DoS攻击，造成服务不可用，推荐使用regexp包进行正则表达式匹配。regexp保证了线性时间性能和优雅的失败：对解析器、编译器和执行引擎都进行了内存限制。但regexp不支持以下正则表达式特性，如业务依赖这些特性，则regexp不适合使用。
<ul>
<li>回溯引用<a class="link" href="https://www.regular-expressions.info/backref.html"  target="_blank" rel="noopener"
    >Backreferences</a></li>
<li>查看<a class="link" href="https://www.regular-expressions.info/lookaround.html"  target="_blank" rel="noopener"
    >Lookaround</a></li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>// good
matched, err := regexp.MatchString(`a.b`, &quot;aaxbb&quot;)
fmt.Println(matched) // true
fmt.Println(err)     // nil
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="后台">后台</h2>
<h3 id="输入校验">输入校验</h3>
<h4 id="必须按类型进行数据校验">【必须】按类型进行数据校验</h4>
<ul>
<li>所有外部输入的参数，应使用<code>validator</code>进行白名单校验，校验内容包括但不限于数据长度、数据范围、数据类型与格式，校验不通过的应当拒绝</li>
</ul>
<pre tabindex="0"><code>// good
import (
	&quot;fmt&quot;
	&quot;github.com/go-playground/validator/v10&quot;
)

var validate *validator.Validate

func validateVariable() {
	myEmail := &quot;abc@tencent.com&quot;
	errs := validate.Var(myEmail, &quot;required,email&quot;)
	if errs != nil {
		fmt.Println(errs)
		return
		//停止执行
	}
	// 验证通过，继续执行
	...
}

func main() {
	validate = validator.New()
	validateVariable()
}
</code></pre><ul>
<li>无法通过白名单校验的应使用<code>html.EscapeString</code>、<code>text/template</code>或<code>bluemonday</code>对<code>&lt;, &gt;, &amp;, ',&quot;</code>等字符进行过滤或编码</li>
</ul>
<pre tabindex="0"><code>import (
	&quot;text/template&quot;
)

// TestHTMLEscapeString HTML特殊字符转义
func main(inputValue string) string {
	escapedResult := template.HTMLEscapeString(inputValue)
	return escapedResult
}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="sql操作">SQL操作</h3>
<h4 id="必须sql语句默认使用预编译并绑定变量">【必须】SQL语句默认使用预编译并绑定变量</h4>
<ul>
<li>使用<code>database/sql</code>的prepare、Query或使用GORM等ORM执行SQL操作</li>
</ul>
<pre tabindex="0"><code>import (
	&quot;github.com/jinzhu/gorm&quot;
	_ &quot;github.com/jinzhu/gorm/dialects/sqlite&quot;
)

type Product struct {
	gorm.Model
	Code  string
	Price uint
}

...
var product Product
...
db.First(&amp;product, 1)
</code></pre><ul>
<li>使用参数化查询，禁止拼接SQL语句，另外对于传入参数用于order by或表名的需要通过校验</li>
</ul>
<pre tabindex="0"><code>// bad
import (
	&quot;database/sql&quot;
	&quot;fmt&quot;
	&quot;net/http&quot;
)

func handler(db *sql.DB, req *http.Request) {
	q := fmt.Sprintf(&quot;SELECT ITEM,PRICE FROM PRODUCT WHERE ITEM_CATEGORY='%s' ORDER BY PRICE&quot;,
		req.URL.Query()[&quot;category&quot;])
	db.Query(q)
}

// good
func handlerGood(db *sql.DB, req *http.Request) {
	// 使用?占位符
	q := &quot;SELECT ITEM,PRICE FROM PRODUCT WHERE ITEM_CATEGORY='?' ORDER BY PRICE&quot;
	db.Query(q, req.URL.Query()[&quot;category&quot;])
}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="网络请求">网络请求</h3>
<h4 id="必须资源请求过滤验证">【必须】资源请求过滤验证</h4>
<ul>
<li>
<p>使用<code>&quot;net/http&quot;</code>下的方法<code>http.Get(url)</code>、<code>http.Post(url, contentType, body)</code>、<code>http.Head(url)</code>、<code>http.PostForm(url, data)</code>、<code>http.Do(req)</code>时，如变量值外部可控（指从参数中动态获取），应对请求目标进行严格的安全校验。</p>
</li>
<li>
<p>如请求资源域名归属固定的范围，如只允许<code>a.qq.com</code>和<code>b.qq.com</code>，应做白名单限制。如不适用白名单，则推荐的校验逻辑步骤是：</p>
<ul>
<li>
<p>第 1 步、只允许HTTP或HTTPS协议</p>
</li>
<li>
<p>第 2 步、解析目标URL，获取其HOST</p>
</li>
<li>
<p>第 3 步、解析HOST，获取HOST指向的IP地址转换成Long型</p>
</li>
<li>
<p>第 4 步、检查IP地址是否为内网IP，网段有：</p>
<pre tabindex="0"><code>// 以RFC定义的专有网络为例，如有自定义私有网段亦应加入禁止访问列表。
10.0.0.0/8
172.16.0.0/12
192.168.0.0/16
127.0.0.0/8
</code></pre></li>
<li>
<p>第 5 步、请求URL</p>
</li>
<li>
<p>第 6 步、如有跳转，跳转后执行1，否则绑定经校验的ip和域名，对URL发起请求</p>
</li>
</ul>
</li>
<li>
<p>官方库<code>encoding/xml</code>不支持外部实体引用，使用该库可避免xxe漏洞</p>
</li>
</ul>
<pre tabindex="0"><code>import (
	&quot;encoding/xml&quot;
	&quot;fmt&quot;
	&quot;os&quot;
)

func main() {
	type Person struct {
		XMLName  xml.Name `xml:&quot;person&quot;`
		Id       int      `xml:&quot;id,attr&quot;`
		UserName string   `xml:&quot;name&gt;first&quot;`
		Comment  string   `xml:&quot;,comment&quot;`
	}

	v := &amp;Person{Id: 13, UserName: &quot;John&quot;}
	v.Comment = &quot; Need more details. &quot;

	enc := xml.NewEncoder(os.Stdout)
	enc.Indent(&quot;  &quot;, &quot;    &quot;)
	if err := enc.Encode(v); err != nil {
		fmt.Printf(&quot;error: %v\n&quot;, err)
	}

}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="服务器端渲染">服务器端渲染</h3>
<h4 id="必须模板渲染过滤验证">【必须】模板渲染过滤验证</h4>
<ul>
<li>使用<code>text/template</code>或者<code>html/template</code>渲染模板时禁止将外部输入参数引入模板，或仅允许引入白名单内字符。</li>
</ul>
<pre tabindex="0"><code>// bad
func handler(w http.ResponseWriter, r *http.Request) {
	r.ParseForm()
	x := r.Form.Get(&quot;name&quot;)

	var tmpl = `&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;
    &lt;form action=&quot;/&quot; method=&quot;post&quot;&gt;
        First name:&lt;br&gt;
    &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&quot;&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
    &lt;/form&gt;&lt;p&gt;` + x + ` &lt;/p&gt;&lt;/body&gt;&lt;/html&gt;`

	t := template.New(&quot;main&quot;)
	t, _ = t.Parse(tmpl)
	t.Execute(w, &quot;Hello&quot;)
}

// good
import (
	&quot;fmt&quot;
	&quot;github.com/go-playground/validator/v10&quot;
)

var validate *validator.Validate
validate = validator.New()

func validateVariable(val) {
	errs := validate.Var(val, &quot;gte=1,lte=100&quot;) // 限制必须是1-100的正整数
	if errs != nil {
		fmt.Println(errs)
		return false
	}
	return true
}

func handler(w http.ResponseWriter, r *http.Request) {
	r.ParseForm()
	x := r.Form.Get(&quot;name&quot;)

	if validateVariable(x) {
		var tmpl = `&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;
            &lt;form action=&quot;/&quot; method=&quot;post&quot;&gt;
            First name:&lt;br&gt;
            &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&quot;&gt;
            &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
            &lt;/form&gt;&lt;p&gt;` + x + ` &lt;/p&gt;&lt;/body&gt;&lt;/html&gt;`
		t := template.New(&quot;main&quot;)
		t, _ = t.Parse(tmpl)
		t.Execute(w, &quot;Hello&quot;)
	} else {
		// ...
	}
}

</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="web跨域">Web跨域</h3>
<h4 id="必须跨域资源共享cors限制请求来源">【必须】跨域资源共享CORS限制请求来源</h4>
<ul>
<li>CORS请求保护不当可导致敏感信息泄漏，因此应当严格设置Access-Control-Allow-Origin使用同源策略进行保护。</li>
</ul>
<pre tabindex="0"><code>// good
c := cors.New(cors.Options{
	AllowedOrigins:   []string{&quot;http://qq.com&quot;, &quot;https://qq.com&quot;},
	AllowCredentials: true,
	Debug:            false,
})

// 引入中间件
handler = c.Handler(handler)
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="响应输出">响应输出</h3>
<h4 id="必须设置正确的http响应包类型">【必须】设置正确的HTTP响应包类型</h4>
<ul>
<li>响应头Content-Type与实际响应内容，应保持一致。如：API响应数据类型是json，则响应头使用<code>application/json</code>；若为xml，则设置为<code>text/xml</code>。</li>
</ul>
<h4 id="必须添加安全响应头">【必须】添加安全响应头</h4>
<ul>
<li>所有接口、页面，添加响应头 <code>X-Content-Type-Options: nosniff</code>。</li>
<li>所有接口、页面，添加响应头<code>X-Frame-Options </code>。按需合理设置其允许范围，包括：<code>DENY</code>、<code>SAMEORIGIN</code>、<code>ALLOW-FROM origin</code>。用法参考：<a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options"  target="_blank" rel="noopener"
    >MDN文档</a></li>
</ul>
<h4 id="必须外部输入拼接到http响应头中需进行过滤">【必须】外部输入拼接到HTTP响应头中需进行过滤</h4>
<ul>
<li>应尽量避免外部可控参数拼接到HTTP响应头中，如业务需要则需要过滤掉<code>\r</code>、<code>\n</code>等换行符，或者拒绝携带换行符号的外部输入。</li>
</ul>
<h4 id="必须外部输入拼接到response页面前进行编码处理">【必须】外部输入拼接到response页面前进行编码处理</h4>
<ul>
<li>直出html页面或使用模板生成html页面的，推荐使用<code>text/template</code>自动编码，或者使用<code>html.EscapeString</code>或<code>text/template</code>对<code>&lt;, &gt;, &amp;, ',&quot;</code>等字符进行编码。</li>
</ul>
<pre tabindex="0"><code>import (
	&quot;html/template&quot;
)

func outtemplate(w http.ResponseWriter, r *http.Request) {
	param1 := r.URL.Query().Get(&quot;param1&quot;)
	tmpl := template.New(&quot;hello&quot;)
	tmpl, _ = tmpl.Parse(`{{define &quot;T&quot;}}{{.}}{{end}}`)
	tmpl.ExecuteTemplate(w, &quot;T&quot;, param1)
}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="会话管理">会话管理</h3>
<h4 id="必须安全维护session信息">【必须】安全维护session信息</h4>
<ul>
<li>用户登录时应重新生成session，退出登录后应清理session。</li>
</ul>
<pre tabindex="0"><code>import (
	&quot;github.com/gorilla/handlers&quot;
	&quot;github.com/gorilla/mux&quot;
	&quot;net/http&quot;
)

// 创建cookie
func setToken(res http.ResponseWriter, req *http.Request) {
	expireToken := time.Now().Add(time.Minute * 30).Unix()
	expireCookie := time.Now().Add(time.Minute * 30)

	//...

	cookie := http.Cookie{
		Name:     &quot;Auth&quot;,
		Value:    signedToken,
		Expires:  expireCookie, // 过期失效
		HttpOnly: true,
		Path:     &quot;/&quot;,
		Domain:   &quot;127.0.0.1&quot;,
		Secure:   true,
	}

	http.SetCookie(res, &amp;cookie)
	http.Redirect(res, req, &quot;/profile&quot;, 307)
}

// 删除cookie
func logout(res http.ResponseWriter, req *http.Request) {
	deleteCookie := http.Cookie{
		Name:    &quot;Auth&quot;,
		Value:   &quot;none&quot;,
		Expires: time.Now(),
	}
	http.SetCookie(res, &amp;deleteCookie)
	return
}
</code></pre><h4 id="必须csrf防护">【必须】CSRF防护</h4>
<ul>
<li>涉及系统敏感操作或可读取敏感信息的接口应校验<code>Referer</code>或添加<code>csrf_token</code>。</li>
</ul>
<pre tabindex="0"><code>// good
import (
	&quot;github.com/gorilla/csrf&quot;
	&quot;github.com/gorilla/mux&quot;
	&quot;net/http&quot;
)

func main() {
	r := mux.NewRouter()
	r.HandleFunc(&quot;/signup&quot;, ShowSignupForm)
	r.HandleFunc(&quot;/signup/post&quot;, SubmitSignupForm)
	// 使用csrf_token验证
	http.ListenAndServe(&quot;:8000&quot;,
		csrf.Protect([]byte(&quot;32-byte-long-auth-key&quot;))(r))
}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="访问控制">访问控制</h3>
<h4 id="必须默认鉴权">【必须】默认鉴权</h4>
<ul>
<li>
<p>除非资源完全可对外开放，否则系统默认进行身份认证，使用白名单的方式放开不需要认证的接口或页面。</p>
</li>
<li>
<p>根据资源的机密程度和用户角色，以最小权限原则，设置不同级别的权限，如完全公开、登录可读、登录可写、特定用户可读、特定用户可写等</p>
</li>
<li>
<p>涉及用户自身相关的数据的读写必须验证登录态用户身份及其权限，避免越权操作</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- 伪代码
</span><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="p">:</span><span class="n">id</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">userid</span><span class="o">=</span><span class="k">session</span><span class="p">.</span><span class="n">userid</span><span class="w">
</span></code></pre></div></li>
<li>
<p>没有独立账号体系的外网服务使用<code>QQ</code>或<code>微信</code>登录，内网服务使用<code>统一登录服务</code>登录，其他使用账号密码登录的服务需要增加验证码等二次验证</p>
</li>
</ul>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="19-并发保护">1.9 并发保护</h3>
<h4 id="191必须禁止在闭包中直接调用循环变量">1.9.1【必须】禁止在闭包中直接调用循环变量</h4>
<ul>
<li>在循环中启动协程，当协程中使用到了循环的索引值，由于多个协程同时使用同一个变量会产生数据竞争，造成执行结果异常。</li>
</ul>
<pre tabindex="0"><code>// bad
func main() {
	runtime.GOMAXPROCS(runtime.NumCPU())
	var group sync.WaitGroup

	for i := 0; i &lt; 5; i++ {
		group.Add(1)
		go func() {
			defer group.Done()
			fmt.Printf(&quot;%-2d&quot;, i) // 这里打印的i不是所期望的
		}()
	}
	group.Wait()
}

// good
func main() {
	runtime.GOMAXPROCS(runtime.NumCPU())
	var group sync.WaitGroup

	for i := 0; i &lt; 5; i++ {
		group.Add(1)
		go func(j int) {
			defer func() {
				if r := recover(); r != nil {
					fmt.Println(&quot;Recovered in start()&quot;)
				}
				group.Done()
			}()
			fmt.Printf(&quot;%-2d&quot;, j) // 闭包内部使用局部变量
		}(i) // 把循环变量显式地传给协程
	}
	group.Wait()
}
</code></pre><h4 id="必须禁止并发写map">【必须】禁止并发写map</h4>
<ul>
<li>并发写map容易造成程序崩溃并异常退出，建议加锁保护</li>
</ul>
<pre tabindex="0"><code>// bad
func main() {
	m := make(map[int]int)
	// 并发读写
	go func() {
		for {
			_ = m[1]
		}
	}()
	go func() {
		for {
			m[2] = 1
		}
	}()
	select {}
}
</code></pre><h4 id="必须确保并发安全">【必须】确保并发安全</h4>
<p>敏感操作如果未作并发安全限制，可导致数据读写异常，造成业务逻辑限制被绕过。可通过同步锁或者原子操作进行防护。</p>
<p>通过同步锁共享内存</p>
<pre tabindex="0"><code>// good
var count int

func Count(lock *sync.Mutex) {
	lock.Lock() // 加写锁
	count++
	fmt.Println(count)
	lock.Unlock() // 解写锁，任何一个Lock()或RLock()均需要保证对应有Unlock()或RUnlock()
}

func main() {
	lock := &amp;sync.Mutex{}
	for i := 0; i &lt; 10; i++ {
		go Count(lock) // 传递指针是为了防止函数内的锁和调用锁不一致
	}
	for {
		lock.Lock()
		c := count
		lock.Unlock()
		runtime.Gosched() // 交出时间片给协程
		if c &gt; 10 {
			break
		}
	}
}
</code></pre><ul>
<li>使用<code>sync/atomic</code>执行原子操作</li>
</ul>
<pre tabindex="0"><code>// good
import (
	&quot;sync&quot;
	&quot;sync/atomic&quot;
)

func main() {
	type Map map[string]string
	var m atomic.Value
	m.Store(make(Map))
	var mu sync.Mutex // used only by writers
	read := func(key string) (val string) {
		m1 := m.Load().(Map)
		return m1[key]
	}
	insert := func(key, val string) {
		mu.Lock() // 与潜在写入同步
		defer mu.Unlock()
		m1 := m.Load().(Map) // 导入struct当前数据
		m2 := make(Map)      // 创建新值
		for k, v := range m1 {
			m2[k] = v
		}
		m2[key] = val
		m.Store(m2) // 用新的替代当前对象
	}
	_, _ = read, insert
}
</code></pre>
</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">相关文章</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/p/prc-go-%E8%AF%AD%E8%A8%80%E5%AE%9E%E8%B7%B5%E4%B8%80/">
        
        
            <div class="article-image">
                <img src="/p/prc-go-%E8%AF%AD%E8%A8%80%E5%AE%9E%E8%B7%B5%E4%B8%80/2.7a753b5d6f830fcff1461f4335565018_hu9db44f85261860f0cd6b40f5490959f6_304073_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-enU7XW&#43;DD8/xRh9DNVZQGA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PRC go 语言实践一</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/redis-go%E8%AF%AD%E8%A8%80%E5%AE%9E%E8%B7%B5%E4%BA%8C/">
        
        
            <div class="article-image">
                <img src="/p/redis-go%E8%AF%AD%E8%A8%80%E5%AE%9E%E8%B7%B5%E4%BA%8C/1.e1b66f52c28f363857e7ea09f5a6f6ef_hu38514b36fb33d89c48254822293248c6_47054_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-4bZvUsKPNjhX5&#43;oJ9ab27w==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">redis GO语言实践二</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/redis-go%E8%AF%AD%E8%A8%80%E5%AE%9E%E8%B7%B5%E4%B8%80/">
        
        
            <div class="article-image">
                <img src="/p/redis-go%E8%AF%AD%E8%A8%80%E5%AE%9E%E8%B7%B5%E4%B8%80/1.3b6d4b99c260135e7e8a370546fb9447_hu92e993ca1384cf9d7fc0be4e9454fb8f_41826_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-O21LmcJgE15&#43;ijcFRvuURw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">redis GO语言实践一</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/disk-test/">
        
        
            <div class="article-image">
                <img src="/p/disk-test/1.de91ce03f087ea28aedd9232dee697aa_hu4b9f21e0357fa4a3de89be2058c4c1e0_86402_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-3pHOA/CH6iiu3ZIy3uaXqg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Disk Test</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-avl-tree-go%E5%AE%9E%E7%8E%B0/">
        
        
            <div class="article-image">
                <img src="/p/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-avl-tree-go%E5%AE%9E%E7%8E%B0/1.ed1f35b2a37347732ac0274cc8b2b8b7_hu627ccad35150ba5c25206c4fe774bc3e_21463_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-7R81sqNzR3MqwCdMyLK4tw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">数据结构-AVL tree go实现</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Chengji Zhao&#39;s blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">目录</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#文章来源">文章来源</a></li>
    <li><a href="#通用">通用</a>
      <ol>
        <li><a href="#内存管理">内存管理</a>
          <ol>
            <li><a href="#必须切片长度校验">【必须】切片长度校验</a></li>
            <li><a href="#必须nil指针判断">【必须】nil指针判断</a></li>
            <li><a href="#必须整数安全">【必须】整数安全</a></li>
            <li><a href="#必须make分配长度验证">【必须】make分配长度验证</a></li>
            <li><a href="#必须禁止setfinalizer和指针循环引用同时使用">【必须】禁止SetFinalizer和指针循环引用同时使用</a></li>
            <li><a href="#必须禁止重复释放channel">【必须】禁止重复释放channel</a></li>
            <li><a href="#必须确保每个协程都能退出">【必须】确保每个协程都能退出</a></li>
            <li><a href="#推荐不使用unsafe包">【推荐】不使用unsafe包</a></li>
            <li><a href="#推荐不使用slice作为函数入参">【推荐】不使用slice作为函数入参</a></li>
          </ol>
        </li>
        <li><a href="#文件操作">文件操作</a>
          <ol>
            <li><a href="#必须-路径穿越检查">【必须】 路径穿越检查</a></li>
            <li><a href="#必须-文件访问权限">【必须】 文件访问权限</a></li>
          </ol>
        </li>
        <li><a href="#系统接口">系统接口</a></li>
        <li><a href="#通信安全">通信安全</a>
          <ol>
            <li><a href="#必须网络通信采用tls方式">【必须】网络通信采用TLS方式</a></li>
            <li><a href="#推荐tls启用证书验证">【推荐】TLS启用证书验证</a></li>
          </ol>
        </li>
        <li><a href="#敏感数据保护">敏感数据保护</a>
          <ol>
            <li><a href="#必须敏感信息访问">【必须】敏感信息访问</a></li>
            <li><a href="#必须敏感数据输出">【必须】敏感数据输出</a></li>
            <li><a href="#必须敏感数据存储">【必须】敏感数据存储</a></li>
            <li><a href="#必须异常处理和日志记录">【必须】异常处理和日志记录</a></li>
          </ol>
        </li>
        <li><a href="#加密解密">加密解密</a>
          <ol>
            <li><a href="#必须不得硬编码密码密钥">【必须】不得硬编码密码/密钥</a></li>
            <li><a href="#162必须密钥存储安全">1.6.2【必须】密钥存储安全</a></li>
            <li><a href="#163推荐不使用弱密码算法">1.6.3【推荐】不使用弱密码算法</a></li>
          </ol>
        </li>
        <li><a href="#正则表达式">正则表达式</a>
          <ol>
            <li><a href="#推荐使用regexp进行正则表达式匹配">【推荐】使用regexp进行正则表达式匹配</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#后台">后台</a>
      <ol>
        <li><a href="#输入校验">输入校验</a>
          <ol>
            <li><a href="#必须按类型进行数据校验">【必须】按类型进行数据校验</a></li>
          </ol>
        </li>
        <li><a href="#sql操作">SQL操作</a>
          <ol>
            <li><a href="#必须sql语句默认使用预编译并绑定变量">【必须】SQL语句默认使用预编译并绑定变量</a></li>
          </ol>
        </li>
        <li><a href="#网络请求">网络请求</a>
          <ol>
            <li><a href="#必须资源请求过滤验证">【必须】资源请求过滤验证</a></li>
          </ol>
        </li>
        <li><a href="#服务器端渲染">服务器端渲染</a>
          <ol>
            <li><a href="#必须模板渲染过滤验证">【必须】模板渲染过滤验证</a></li>
          </ol>
        </li>
        <li><a href="#web跨域">Web跨域</a>
          <ol>
            <li><a href="#必须跨域资源共享cors限制请求来源">【必须】跨域资源共享CORS限制请求来源</a></li>
          </ol>
        </li>
        <li><a href="#响应输出">响应输出</a>
          <ol>
            <li><a href="#必须设置正确的http响应包类型">【必须】设置正确的HTTP响应包类型</a></li>
            <li><a href="#必须添加安全响应头">【必须】添加安全响应头</a></li>
            <li><a href="#必须外部输入拼接到http响应头中需进行过滤">【必须】外部输入拼接到HTTP响应头中需进行过滤</a></li>
            <li><a href="#必须外部输入拼接到response页面前进行编码处理">【必须】外部输入拼接到response页面前进行编码处理</a></li>
          </ol>
        </li>
        <li><a href="#会话管理">会话管理</a>
          <ol>
            <li><a href="#必须安全维护session信息">【必须】安全维护session信息</a></li>
            <li><a href="#必须csrf防护">【必须】CSRF防护</a></li>
          </ol>
        </li>
        <li><a href="#访问控制">访问控制</a>
          <ol>
            <li><a href="#必须默认鉴权">【必须】默认鉴权</a></li>
          </ol>
        </li>
        <li><a href="#19-并发保护">1.9 并发保护</a>
          <ol>
            <li><a href="#191必须禁止在闭包中直接调用循环变量">1.9.1【必须】禁止在闭包中直接调用循环变量</a></li>
            <li><a href="#必须禁止并发写map">【必须】禁止并发写map</a></li>
            <li><a href="#必须确保并发安全">【必须】确保并发安全</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
